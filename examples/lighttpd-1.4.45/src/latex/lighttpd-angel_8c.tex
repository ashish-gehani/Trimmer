\hypertarget{lighttpd-angel_8c}{\section{lighttpd-\/angel.c File Reference}
\label{lighttpd-angel_8c}\index{lighttpd-\/angel.\-c@{lighttpd-\/angel.\-c}}
}
{\ttfamily \#include \char`\"{}first.\-h\char`\"{}}\\*
{\ttfamily \#include $<$sys/wait.\-h$>$}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include $<$errno.\-h$>$}\\*
{\ttfamily \#include $<$unistd.\-h$>$}\\*
{\ttfamily \#include $<$time.\-h$>$}\\*
{\ttfamily \#include $<$signal.\-h$>$}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{lighttpd-angel_8c_a23427a949693026cd5a2e76d6f5123d6}{B\-I\-N\-P\-A\-T\-H}~S\-B\-I\-N\-\_\-\-D\-I\-R\char`\"{}/lighttpd\char`\"{}
\item 
\#define \hyperlink{lighttpd-angel_8c_a86d500a34c624c2cae56bc25a31b12f3}{U\-N\-U\-S\-E\-D}(x)~( (void)(x) )
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{lighttpd-angel_8c_a2a20974208b6a1ef316e2b916f18e93f}{sigaction\-\_\-handler} (int sig, siginfo\-\_\-t $\ast$si, void $\ast$context)
\item 
int \hyperlink{lighttpd-angel_8c_a3c04138a5bfe5d72780bb7e82a18e627}{main} (int argc, char $\ast$$\ast$\hyperlink{lemon_8c_af2efa898e9eed6fe6715279cb1ec35b0}{argv})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static siginfo\-\_\-t \hyperlink{lighttpd-angel_8c_a5afc1a3d202d014401a370df440c52d0}{last\-\_\-sigterm\-\_\-info}
\item 
static siginfo\-\_\-t \hyperlink{lighttpd-angel_8c_aa06fffa391286db054a0d51ae94096b2}{last\-\_\-sighup\-\_\-info}
\item 
static volatile sig\-\_\-atomic\-\_\-t \hyperlink{lighttpd-angel_8c_aec4d4b2dd9e166ad2c84b1f73d70aae2}{start\-\_\-process} = 1
\item 
static volatile pid\-\_\-t \hyperlink{lighttpd-angel_8c_a621c8fc233a319aebb077fe9a9665251}{pid} = -\/1
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{lighttpd-angel_8c_a23427a949693026cd5a2e76d6f5123d6}{\index{lighttpd-\/angel.\-c@{lighttpd-\/angel.\-c}!B\-I\-N\-P\-A\-T\-H@{B\-I\-N\-P\-A\-T\-H}}
\index{B\-I\-N\-P\-A\-T\-H@{B\-I\-N\-P\-A\-T\-H}!lighttpd-angel.c@{lighttpd-\/angel.\-c}}
\subsubsection[{B\-I\-N\-P\-A\-T\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define B\-I\-N\-P\-A\-T\-H~S\-B\-I\-N\-\_\-\-D\-I\-R\char`\"{}/lighttpd\char`\"{}}}\label{lighttpd-angel_8c_a23427a949693026cd5a2e76d6f5123d6}
angel process for lighttpd

the purpose is the run as root all the time and handle\-:
\begin{DoxyItemize}
\item restart on crash
\item spawn on H\-U\-P to allow graceful restart
\item ...
\end{DoxyItemize}

it has to stay safe and small to be trustable 

Referenced by main().

\hypertarget{lighttpd-angel_8c_a86d500a34c624c2cae56bc25a31b12f3}{\index{lighttpd-\/angel.\-c@{lighttpd-\/angel.\-c}!U\-N\-U\-S\-E\-D@{U\-N\-U\-S\-E\-D}}
\index{U\-N\-U\-S\-E\-D@{U\-N\-U\-S\-E\-D}!lighttpd-angel.c@{lighttpd-\/angel.\-c}}
\subsubsection[{U\-N\-U\-S\-E\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define U\-N\-U\-S\-E\-D(
\begin{DoxyParamCaption}
\item[{}]{x}
\end{DoxyParamCaption}
)~( (void)(x) )}}\label{lighttpd-angel_8c_a86d500a34c624c2cae56bc25a31b12f3}


Referenced by main(), and sigaction\-\_\-handler().



\subsection{Function Documentation}
\hypertarget{lighttpd-angel_8c_a3c04138a5bfe5d72780bb7e82a18e627}{\index{lighttpd-\/angel.\-c@{lighttpd-\/angel.\-c}!main@{main}}
\index{main@{main}!lighttpd-angel.c@{lighttpd-\/angel.\-c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$$\ast$}]{argv}
\end{DoxyParamCaption}
)}}\label{lighttpd-angel_8c_a3c04138a5bfe5d72780bb7e82a18e627}
we are running as root B\-E\-W\-A\-R\-E

error

make sure we are not in a race between the signal handler and the process restart

process went away

normal exit

got a signal 

References B\-I\-N\-P\-A\-T\-H, pid, sigaction\-\_\-handler(), start\-\_\-process, and U\-N\-U\-S\-E\-D.

\hypertarget{lighttpd-angel_8c_a2a20974208b6a1ef316e2b916f18e93f}{\index{lighttpd-\/angel.\-c@{lighttpd-\/angel.\-c}!sigaction\-\_\-handler@{sigaction\-\_\-handler}}
\index{sigaction\-\_\-handler@{sigaction\-\_\-handler}!lighttpd-angel.c@{lighttpd-\/angel.\-c}}
\subsubsection[{sigaction\-\_\-handler}]{\setlength{\rightskip}{0pt plus 5cm}static void sigaction\-\_\-handler (
\begin{DoxyParamCaption}
\item[{int}]{sig, }
\item[{siginfo\-\_\-t $\ast$}]{si, }
\item[{void $\ast$}]{context}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{lighttpd-angel_8c_a2a20974208b6a1ef316e2b916f18e93f}
forward the sig to the child

do a graceful restart

do a graceful shutdown on the main process and start a new child

wait 5 microsec

a child died, de-\/combie it 

References last\-\_\-sighup\-\_\-info, last\-\_\-sigterm\-\_\-info, pid, start\-\_\-process, and U\-N\-U\-S\-E\-D.



Referenced by main().



\subsection{Variable Documentation}
\hypertarget{lighttpd-angel_8c_aa06fffa391286db054a0d51ae94096b2}{\index{lighttpd-\/angel.\-c@{lighttpd-\/angel.\-c}!last\-\_\-sighup\-\_\-info@{last\-\_\-sighup\-\_\-info}}
\index{last\-\_\-sighup\-\_\-info@{last\-\_\-sighup\-\_\-info}!lighttpd-angel.c@{lighttpd-\/angel.\-c}}
\subsubsection[{last\-\_\-sighup\-\_\-info}]{\setlength{\rightskip}{0pt plus 5cm}siginfo\-\_\-t last\-\_\-sighup\-\_\-info\hspace{0.3cm}{\ttfamily [static]}}}\label{lighttpd-angel_8c_aa06fffa391286db054a0d51ae94096b2}


Referenced by sigaction\-\_\-handler().

\hypertarget{lighttpd-angel_8c_a5afc1a3d202d014401a370df440c52d0}{\index{lighttpd-\/angel.\-c@{lighttpd-\/angel.\-c}!last\-\_\-sigterm\-\_\-info@{last\-\_\-sigterm\-\_\-info}}
\index{last\-\_\-sigterm\-\_\-info@{last\-\_\-sigterm\-\_\-info}!lighttpd-angel.c@{lighttpd-\/angel.\-c}}
\subsubsection[{last\-\_\-sigterm\-\_\-info}]{\setlength{\rightskip}{0pt plus 5cm}siginfo\-\_\-t last\-\_\-sigterm\-\_\-info\hspace{0.3cm}{\ttfamily [static]}}}\label{lighttpd-angel_8c_a5afc1a3d202d014401a370df440c52d0}


Referenced by sigaction\-\_\-handler().

\hypertarget{lighttpd-angel_8c_a621c8fc233a319aebb077fe9a9665251}{\index{lighttpd-\/angel.\-c@{lighttpd-\/angel.\-c}!pid@{pid}}
\index{pid@{pid}!lighttpd-angel.c@{lighttpd-\/angel.\-c}}
\subsubsection[{pid}]{\setlength{\rightskip}{0pt plus 5cm}volatile pid\-\_\-t pid = -\/1\hspace{0.3cm}{\ttfamily [static]}}}\label{lighttpd-angel_8c_a621c8fc233a319aebb077fe9a9665251}


Referenced by cgi\-\_\-connection\-\_\-close(), cgi\-\_\-create\-\_\-env(), cgi\-\_\-pid\-\_\-add(), main(), mod\-\_\-rrd\-\_\-create\-\_\-pipe(), process\-\_\-ssi\-\_\-stmt(), and sigaction\-\_\-handler().

\hypertarget{lighttpd-angel_8c_aec4d4b2dd9e166ad2c84b1f73d70aae2}{\index{lighttpd-\/angel.\-c@{lighttpd-\/angel.\-c}!start\-\_\-process@{start\-\_\-process}}
\index{start\-\_\-process@{start\-\_\-process}!lighttpd-angel.c@{lighttpd-\/angel.\-c}}
\subsubsection[{start\-\_\-process}]{\setlength{\rightskip}{0pt plus 5cm}volatile sig\-\_\-atomic\-\_\-t start\-\_\-process = 1\hspace{0.3cm}{\ttfamily [static]}}}\label{lighttpd-angel_8c_aec4d4b2dd9e166ad2c84b1f73d70aae2}


Referenced by main(), and sigaction\-\_\-handler().

